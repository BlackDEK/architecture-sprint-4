# Планирование: анализ, идентификация проблем и поиск решений

## Проблемные места

### Существующие проблемные места

Тут содержаться текущие проблемы которые уже сейчас влияют на продукт.

- Клиенты не получают заказы. Клиенты жалуются менеджерам по продажам, что они не получили заказ
- Высокая нагрузка на API. Есть жалобы со стороны компании на отсутствие заказов.
- Неудобный UI у MES. Операторам важно видеть самые новые заказы, но текущий фильтр не дает это сделать.
- Высокая нагрузка на MES. При заходе на страницу с заказами идет долгая загрузка информации о заказах.
- Отсутствие масштабируемости. Каждый контейнер не может быть поднят в нескольких экземплярах для снижения нагрузки. Нет возможности динамически повышать нагрузку.
- Высокая нагрузка на базы данных. В следствие отсутствия кэширования шардирования и репликации происходит задержка при загрузки заказов.
- Задержка в релизах. Ряд релизов были выпущены с задержкой.
- Низкая отказоустойчивость. Часть заказов может быть потеряна при высокой нагрузке.
- Общая БД между CRM и Shop. В следствии этого могут быть задержки при обработке заказов и ошибки в заказах.
- Нету инструментов для наблюдения за системой. Это может привести к потенциальным скрытым ошибкам которые могут быть обнаружены через месяцы работы программы.
  - Нету логирования. Необходим чтобы отслеживать не корректное поведение как в рамках программы(ошибки при отправке сообщения или открытия файла), так и в рамках бизнес процессов(просрочка заказа из-за высокой нагрузки на операторов).
  - Нету мониторинга. Необходим чтобы отслеживать нагрузку и прогнозировать необходимые ресурсы для проекта.
  - Нету трейсинга. Необходим чтобы отслеживать сущность перемещающиеся между микросервисами. В нашем случае для сущности заказ.
- Нету коммуникации между разработчиками и заказчиками. Операторам необходимо фильтровать заказы по новизне, однако данная возможность не была добавлена при разработке фильтра.
- Возможные проблемы связанные с защитой api. После предоставления api произошло скачек заказов, необходимо проверить есть ли в api дыры через которые можно перегрузить приложение.

## Способы решение

### Internet Shop

1. Доработка системы коммуникации с пользователем, с целью его уведомления о статусе заказа.Необходимо чтобы при пиковой нагрузке не обработанные заказы могли быть повторно переоткрыты пользователем.

### MES

1. Доработка UI с учетом пожеланий операторов, чтобы они могли удобно выбрать новые заказы и отслеживать выполняемые. То есть при загрузке сайта с заказами сначала выдавать все самые новые заказы.
2. Установка ограничения на кол-во запросов к API MES со стороны внешних пользователей.
3. Внедрение кеширования для MES БД, что позволит упростить доступ к заказам для операторов.
4. Разработка механизма масштабирования для MES.

### CRM

1. Внедрение механизмов ограничения времени расчета в зависимости от стоимости модели.
   - Денежный ценз для высоко полигональных моделей позволит снизить нагрузку.
2. Разделение общей БД CRM и Shop с целью уменьшение нагрузки и упрощению разработки.
3. Разработка механизма масштабирования для CRM.

### Повышение видимости системы

1. Внедрение логирования.
2. Внедрение трассировки.
3. Внедрение мониторинга.

### Повышение отказоустойчивости

1. Внедрение механизмов снижения нагрузки.

### Процесс разработки и развертывания

1. Автоматизация тестирования.
2. Настройка инфраструктуры для авто масштабирования.

## Приоритет в задачах

### Временные меры

  1. MES, пункт: 1. Он нужен чтобы повысить продуктивность операторов, так как им необходимо видеть новые заказы, чтобы их можно было брать.
  2. MES, пункт: 2. Позволит снизить нагрузку на сервера со стороны внешних пользователей, так как основная задача удержать B2C клиентов.
  3. CRM, пункт: 1. Позволит снизить нагрузку и возможно повысить прибыль. Мера временная, при постепенном решении проблем её можно будет убрать.

### Системные меры

  1. Повышение видимости системы, пункт: 3. Необходимо внедрить мониторинг для отслеживания пиковых нагрузок и прогнозирования кол-ва необходимого оборудования. Также данный пункт покажет на сколько хороши последующие инициативы.
  2. Повышение отказоустойчивости, пункт: 1. Он позволит системе не падать при пиковой нагрузке.
  3. Internet Shop, пункт: 1. Позволит в случае утери заказа или невозможности его открыть сейчас, уведомить пользователя что он может заново открыть заказ.
  4. MES 3. Внедрение кэширования позволит ускорить работу операторов с системой и выполнять заказы быстро.
  5. Повышение видимости системы, пункт: 2. Позволит решить проблему с утерей заказов, а также упросит поиск проблем связанных с обработкой заказов.
  6. Повышение видимости системы, пункт: 1. Надо повысить видимость системы, чтобы своевременно и корректно устранять ошибки, а также планировать новые изменения.  
  7. MES 4, а также CRM 2, 3. Это последние пункты, так как внедрение данных технологий надо делать после внедрения метрик и анализа.

## Архитектура через полгода

Стоит отметить что надо прежде всего сосредоточиться на решении проблем связанных с клиентами, проблемы с API могут подождать.

- Через полгода в архитектуре будут устранены следующие проблемы.
  - Будут приняты все "временные меры", чтобы временно повысить отзывчивость системы. Их можно сделать всегда, так как они реализуются очень быстро.
  - Будут решены проблемы связанные с B2C. То есть будут будут выполнены следующие пункты из раздела "Системные меры".
    - 1, 2, 3, 4, 5, 6. (План максимум)
  - В случае если можно будет реализовать только 3 пункта из раздела "Системные меры".
    - 1, 2, 3. (План минимум)
