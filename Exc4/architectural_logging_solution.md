# Архитектурное решение по логированию

## Какие логи надо собирать

- Business. Категория для логов связанных с выполнением бизнес процессов.
  - INFO. Подкатегория для логов уведомляющих о выполнении бизнес процесса.
    - Произошло обновления статуса заказа.
    - Возврата платежа за заказ.
  - WARN. Подкатегория для некритичных ошибок и странного поведения при выполнении бизнес процессов.
    - Оформление большого кол-во заказов на новый профиль.
  - ERROR. Подкатегория для критичных ошибок при выполнении бизнес процессов.
    - Ошибка при оформлении заказа, из-за отсутствия товара на складе.
- Program. Категория логов связанных с программны или аппаратными процессами.
  - INFO. Подкатегория для логов уведомляющих о выполнении программного процесса.
    - Установлено соединение с БД.
    - Подгружен конфиг.
  - WARN. Подкатегория для некритичных ошибок и странного поведения.
    - Не удалось получить связаться с сервером.
  - ERROR. Подкатегория для критичных программных ошибок.
    - Не хватка памяти при работе программы.

## Список логов с уровнем INFO

- Бизнес логи
  - Для заказов.
    - Создание заказа.
      - Время, id покупателя, id заказа.
    - Взятие заказа оператором.
      - Время, id заказа, id оператора.
    - Подтверждение выполнения заказа оператором.
      - Время, id заказа, id оператора, id продавца.
    - Передача заказа в курьерскую службу.
      - Время, id заказа, id посылки.
    - Отмена заказа.
      - Время, id заказа, причина.
    - Получение заказа.
      - Время, id заказа.
  - Для платежей.
    - Выполнение платежа.
      - Время, id заказа, id транзакции.
    - Возврат средств.
      - Время, id заказа, id транзакции.

## Мотивация

- Внедрение логирования позволит.
  - Упростить отладку программы.
  - Снизить время на исправления ошибок.
  - Ускорить процесс поиска узких мест.
- Тех и бизнес метрики.
  - Время задержки выпуска новых релизов.
  - Время разработки новых фич.
  - Время обработки заказов.
  - Частота сбоев.
  - Скорость обработки заказов.

## Предлагаемое решение

- Приоритет разработки.
  - Процесс обработки заказов. Сейчас нужно разобраться с почему заказы пользователей не обрабатываются.
  - Процесс обработки платежей. Нужно обеспечить логирования системы обработки платежей, чтобы не допустить финансовых потерь.
  - Процесс доставки. Необходимо обеспечить автоматизированное логирование отправки и приема заказов, чтобы избежать не нужных инцидентов.
- Технологии.
  - Будем использовать стек ELK и Beats.
    - ElasticSearch - хранит данные.
    - Logstash - обрабатывает данные.
    - Kibana - визуализирует данные.
    - Beats - агрегирует данные с сервисов.
- Политика безопасности.
  - Хранить все данные связанные с логами в закрытом контуре компании и получать доступ к ним, только из офиса.
  - Ограничить доступ к логам, чтобы не авторизированные пользователи не могли получить доступ.
- Политика хранения.
  - Установить срок жизни логов.
  - Установить ограничение на размер логов, при превышении которого система будет очищать старые логи.

### Систему анализа логов

- Для создание системы анализа логов надо настроить.
  - Уведомления об ошибках. Чтобы система уведомляла разработчика если появляются критические ошибки.
  - Дашборд. Он позволит собирать аналитику и анализировать работу программы.
    - Например. Кол-во выполненных заказов за месяц и т.д.
